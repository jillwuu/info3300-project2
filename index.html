<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <title> CS 3300 - Project 2 </title>
  <link rel="stylesheet" type="text/css" href="styles/style.css"/>
  <link href="https://fonts.googleapis.com/css?family=Anton" rel="stylesheet">
  <script src="scripts/d3/d3.min.js"></script>


</head>
    
<body>
    <h1>MARVELâ„¢ Social Network</h1>
    <svg />
    <script>

        //inspiration: https://bl.ocks.org/mbostock/4062045


        var padding = 20;
        var height = 800;
        var width = 1200;
        var radius = 5;
        
        /* Loading initial data:
        declares Avengers array, which contains list of all Avenger names
        declares and filles in mcuCharacters, which contains a list of all characters in the Marvel Cinematic Universe excluding the Avengers.
        Then calls fillHeroNetwork with the mcuCharacters
        */

        var Avengers = ["Tony Stark/Iron Man","Steve Rogers/Captain America","Bruce Banner/Hulk","Black Widow","Hawkeye","Thor"];

        function remove(array, element){
            var index = array.indexOf(element);
            array.splice(index, 1);
        }

        //create array of all the characters we want to represent
        var mcuCharacters = [];
        var mcuCharNoAveng = [];
        d3.csv("mcuCharacters.csv", function(data){
            data.forEach(function(d){
                mcuCharacters.push(d.heroes);
                mcuCharNoAveng.push(d.heroes);
            })
            Avengers.forEach(function(d){
                mcuCharacters.push(d);
            })
            fillHeroNetwork(mcuCharacters, mcuCharNoAveng);
        })

        function fillHeroNetwork(mcuCharacters, mcuCharNoAveng){
            //initialize heronetwork
            var heroNetwork = new Object();
            heroNetwork.nodes = [];
            heroNetwork.links = [];
            //add nodes to data object
            mcuCharacters.forEach(function(element){
                var charObj = new Object();
                charObj.id = element;
                heroNetwork.nodes.push(charObj);
            })

            d3.csv("mcu-network.csv", function(error, data) {
                if (error) console.log(error);
                data.forEach(function(element){
                    hero1 = element["hero1"].trim();
                    hero2 = element["hero2"].trim();
                    if(mcuCharacters.includes(hero1) && mcuCharacters.includes(hero2) ){
                        var color;
                        if (Avengers.includes(hero1) && Avengers.includes(hero2)){
                            color = "#000000";
                        }
                        else if (hero1 == "Tony Stark/Iron Man" || hero2 == "Tony Stark/Iron Man"){
                            color = "#b20000";
                        }else if (hero1 == "Steve Rogers/Captain America" || hero2 == "Steve Rogers/Captain America"){
                            color = "#3232ff";
                        } else if (hero1 == "Bruce Banner/Hulk" || hero2 == "Bruce Banner/Hulk"){
                            color = "#4ca64c";
                        } else if (hero1 == "Black Widow" || hero2 == "Black Widow"){
                            color = "#ffb732";
                        } else if (hero1 == "Hawkeye" || hero2 == "Hawkeye"){
                            color = "#a64ca6";
                        } else if (hero1 == "Thor" || hero2 == "Thor"){
                            color = "#ffff4c";
                        }else {
                            color = "#808080";
                        }

                        var linkObj = {"source": hero1, "target": hero2, "color": color};
                        if (!heroNetwork.links.includes(linkObj)){
                            heroNetwork.links.push(linkObj);
                        }
                    }


                })
                console.log(heroNetwork);
                callback(heroNetwork);
            });
        }
        
        
        
        /* showMap:
        Takes the svg, coordinate array, and line array to map the visual elements.
        Can change the inputs to show Avenger connected characters or not.
        */
        function callback(heroMap){
             
            var svg = d3.select("svg")
                .attr("height", height).attr("width", width);

            var nodes = heroMap.nodes;
            var links = heroMap.links;

            var simulation = d3.forceSimulation()
                             .force("link", d3.forceLink().id(function(d) { return d.id; }))
                             .force("charge", d3.forceManyBody().strength(-1500))
                             .force("center", d3.forceCenter(width/2, height/2));

            var toolTip = d3.select("body")
                            .append("div")
                            .attr("class", "tooltip")
                            .style("opacity", "0")
                            .style("display", "none");

            var link = svg.append("g")
                        .attr("class", "links")
                        .selectAll("line")
                        .data(links)
                        .enter().append("line")
                        .attr("stroke-width", "2")
                        .attr("stroke", function(d) {
                            return d.color;
                        })
                        .attr("stroke-opacity", "0.6");

            var node = svg.append("g")
                        .attr("class", "nodes")
                        .selectAll("circle")
                        .data(nodes)
                        .enter().append("circle")
                        .attr("r", 5)
                        .attr("fill", "white")
                        .call(d3.drag()
                            .on("start", dragstarted)
                            .on("drag", dragged)
                            .on("end", dragended))
                        .on("mouseover", function(d){
                            toolTip.transition()
                                .duration(200)
                                .style("display", "block")
                                .style("opacity", 0.9);
                            toolTip.html(d.id)
                                    .style("left", (d3.event.pageX) + "px")
                                    .style("top", (d3.event.pageY) + "px");
                            console.log(d.id);
                        })
                        .on("mouseout", function(d){
                            toolTip.transition()
                                .duration(500)
                                .style("display", "none")
                                .style("opacity", 0);
                        })
                        ;
            


            nodes.forEach(function(d){
                if (d.id == "Tony Stark/Iron Man"){
                    d.fx = 50;
                    d.fy = 20;
                    d.x = 50;
                    d.y = 20;
                }
                else if (d.id == "Steve Rogers/Captain America"){
                    d.fx = width/2 + 20;
                    d.fy = 50;
                    d.x = width/2 + 20;
                    d.y = 50;
                } else if (d.id == "Bruce Banner/Hulk"){
                    d.fx = width - 50;
                    d.fy = 20;
                    d.x = width - 50;
                    d.y = 20;
                } else if (d.id == "Black Widow"){
                    d.fx = 20;
                    d.fy = height - 30;
                    d.x = 20;
                    d.y = height - 30;
                } else if (d.id == "Hawkeye"){
                    d.fx = width/2 + 50;
                    d.fy = height - 20;
                    d.x = width/2 + 50;
                    d.y = height - 20;
                } else if (d.id == "Thor"){
                    d.fx = width - 20;
                    d.fy = height - 30;
                    d.x = width - 20;
                    d.y = height - 30;
                } 
            })

            node.append("title")
                .text(function(d){ return d.id; });

            simulation.nodes(nodes)
                        .on("tick", ticked);

            simulation.force("link")
                .links(links);

            function ticked() {
                link
                    .attr("x1", function(d) { return d.source.x = Math.max(radius, Math.min(width - radius, d.source.x)); })
                    .attr("y1", function(d) { return d.source.y = Math.max(radius, Math.min(width - radius, d.source.y)); })
                    .attr("x2", function(d) { return d.target.x = Math.max(radius, Math.min(width - radius, d.target.x)); })
                    .attr("y2", function(d) { return d.target.y = Math.max(radius, Math.min(width - radius, d.target.y)); });

                node
                    .attr("cx", function(d) { return d.x = Math.max(radius, Math.min(width - radius, d.x)); })
                    .attr("cy", function(d) { return d.y = Math.max(radius, Math.min(height - radius, d.y)); });
            }

            function dragstarted(d) {
              if (!d3.event.active) simulation.alphaTarget(0.3).restart();

            }

            function dragged(d) {
              d.fx = d3.event.x;
              d.fy = d3.event.y;
            }

            function dragended(d) {
              simulation.alphaTarget(0).restart()
            }
            
        }
    
    </script>
</body>
